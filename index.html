<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>AR Viewer</title>

<script type="module" src="https://unpkg.com/@google/model-viewer@3.3.0/dist/model-viewer.min.js"></script>

<style>
* { margin:0; padding:0; box-sizing:border-box; }

body, html {
  width:100%;
  height:100%;
  overflow:hidden;
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  background:linear-gradient(180deg,#0a0a0a 0%,#1a1a2e 100%);
}

model-viewer {
  width:100vw;
  height:100vh;
}

button[slot="ar-button"] {
  position:absolute;
  bottom:120px;
  left:50%;
  transform:translateX(-50%);
  background:linear-gradient(135deg,#0DF2DF,#0AC5B8);
  border:none;
  color:white;
  padding:20px 50px;
  border-radius:30px;
  font-size:20px;
  font-weight:bold;
  cursor:pointer;
  z-index:1000;
  box-shadow:0 8px 30px rgba(13,242,223,0.6);
}
</style>
</head>

<body>

<div id="loading">
  <div style="color:white;text-align:center;margin-top:50%">Loading...</div>
</div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const modelUrl = urlParams.get('model');
const title = urlParams.get('title') || 'AR Item';
const autoAR = urlParams.get('autoAR') === 'true';

if (!modelUrl) {
  document.body.innerHTML = '<div style="color:white;text-align:center;margin-top:50%">No 3D model provided.</div>';
} else {

document.body.innerHTML = `
<model-viewer id="viewer"
  src="${decodeURIComponent(modelUrl)}"
  alt="${decodeURIComponent(title)}"
  ar
  ar-modes="webxr"
  camera-controls
  auto-rotate
  shadow-intensity="1"
  ar-scale="auto"
  ar-placement="floor">

  <button slot="ar-button" id="ar-button">View in AR</button>
</model-viewer>

<div id="loading" style="color:white;text-align:center;margin-top:50%">Loading Model...</div>
`;

const viewer = document.getElementById('viewer');
const loading = document.getElementById('loading');

viewer.addEventListener('load', () => {
  console.log('✅ Model loaded');
  loading.style.display = 'none';

  if (autoAR) {
    setTimeout(() => viewer.activateAR(), 1000);
  }
});

viewer.addEventListener('error', (e) => {
  console.error('❌ Model error:', e);
  loading.innerHTML = 'Failed to load model.';
});

viewer.addEventListener('ar-status', (event) => {
  console.log('AR Status:', event.detail.status);

  if (event.detail.status === 'failed') {
    alert('AR failed. WebXR not supported on this device.');
  }
});
}
</script>

</body>
</html>
